<h2 class="content-block">{{ '@Dashboard groups' | transloco }}</h2>
<div class="card">
  <p-table
    #dt
    (onLazyLoad)="loadGroups($event)"
    [globalFilterFields]="['name']"
    [lazy]="true"
    [loading]="(loading$ | async) ?? false"
    [paginator]="true"
    [rowHover]="true"
    [rowsPerPageOptions]="[5, 10, 20]"
    [rows]="10"
    [sortOrder]="1"
    [tableStyle]="{ 'min-width': '50rem' }"
    [totalRecords]="totalRecords"
    [value]="dashboardGroups$ | async"
    class="p-datatable-striped"
    dataKey="id"
    id="dashboardGroupsTable"
    sortField="name"
    stateKey="portal-dashboard-groups-table"
    stateStorage="session"
  >
    <ng-template pTemplate="caption">
      <div class="flex items-center justify-between">
        <p-button (click)="createDashboardGroup()" severity="success" icon="fas fa-circle-plus"
                  label="{{'@Create dashboard group' | transloco }}" pRipple
                  (keydown.enter)="createDashboardGroup()"/>
        <p-iconfield>
          <p-inputicon class="pi pi-search"/>
          <input #textInput (input)="dt.filterGlobal(filterValue, 'contains')" [(ngModel)]="filterValue" pInputText
                 placeholder="{{'@Search' | transloco}}" type="text"/>
        </p-iconfield>
      </div>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th id="nameHeader" pSortableColumn="name">
          {{ '@Group name' | transloco }}
          <p-sortIcon field="name"/>
        </th>
        <th id="entriesHeader">
          {{ '@Dashboards' | transloco }}
        </th>
        <th id="createdDateHeader" pSortableColumn="createdDate" style="width:15rem">
          {{ '@Created date' | transloco }}
          <p-sortIcon field="createdDate"/>
        </th>
        <th id="actionsHeader" style="width:8rem"></th>
      </tr>
    </ng-template>
    <ng-template let-group pTemplate="body">
      <tr>
        <td>
          {{ group.name }}
        </td>
        <td>
          @if (!group.entries || group.entries.length === 0) {
            <span class="text-gray-400 text-sm">{{ '@No dashboards' | transloco }}</span>
          } @else {
            <div class="flex flex-col gap-2">
              @for (domainEntry of groupEntriesByDomain(group.entries) | keyvalue; track domainEntry.key) {
                <div>
                  <span class="text-sm font-semibold">{{ getDomainName(domainEntry.key) }}:</span>
                  <span class="flex flex-wrap gap-1 mt-1">
                    @for (entry of domainEntry.value; track entry.dashboardId) {
                      <p-badge [value]="entry.dashboardTitle" severity="info" styleClass="text-sm"/>
                    }
                  </span>
                </div>
              }
            </div>
          }
        </td>
        <td>
          @if (group.createdDate) {
            <span>{{ group.createdDate | date: 'dd.MM.yyyy HH:mm:ss' }}</span>
          }
        </td>
        <td>
          <p-button (click)="editDashboardGroup(group)" (keydown.enter)="editDashboardGroup(group)"
                    [pTooltip]="'@Edit' | transloco"
                    tooltipPosition="top"
                    severity="success"
                    icon="fas fa-light fa-pen-to-square"
                    [rounded]="true"
                    [text]="true"
                    class="mr-2"/>
          <p-button (click)="showDeletionPopup(group)" (keydown.enter)="showDeletionPopup(group)"
                    [pTooltip]="'@Delete' | transloco"
                    tooltipPosition="top"
                    severity="danger"
                    icon="fas fa-trash"
                    [rounded]="true"
                    [text]="true"/>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<br/>
<app-delete-dashboard-group-popup [action]="getDeletionAction()"/>
