<h2 class="content-block">{{ '@Dashboard groups' | transloco }}</h2>
<div class="card">
  <p-toolbar class="mb-6 gap-2">
    <ng-template pTemplate="left">
      <p-button (click)="createDashboardGroup()" severity="success" icon="fas fa-circle-plus"
                label="{{'@Create dashboard group' | transloco }}" pRipple
                (keydown.enter)="createDashboardGroup()"></p-button>
    </ng-template>
  </p-toolbar>

  <p-table
    #dt
    (onLazyLoad)="loadGroups($event)"
    [globalFilterFields]="['name']"
    [lazy]="true"
    [loading]="(loading$ | async) ?? false"
    [paginator]="true"
    [rowHover]="true"
    [rowsPerPageOptions]="[5, 10, 20]"
    [rows]="10"
    [sortOrder]="1"
    [tableStyle]="{ 'min-width': '50rem' }"
    [totalRecords]="totalRecords"
    [value]="dashboardGroups$ | async"
    class="p-datatable-striped"
    dataKey="id"
    id="dashboardGroupsTable"
    sortField="name"
    stateKey="portal-dashboard-groups-table"
    stateStorage="session"
  >
    <ng-template pTemplate="caption">
      <div>
        <div id="searchBox">
          <span class="p-input-icon-left p-ml-auto">
            <p-iconfield>
              <p-inputicon class="pi pi-search"/>
              <input #textInput (input)="dt.filterGlobal(filterValue, 'contains')" [(ngModel)]="filterValue" pInputText
                     placeholder="{{'@Search' | transloco}}" type="text"/>
            </p-iconfield>
          </span>
        </div>
      </div>
      <br><br><br>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th id="nameHeader" pSortableColumn="name">
          {{ '@Group name' | transloco }}
          <p-sortIcon field="name"/>
        </th>
        <th id="entriesHeader">
          {{ '@Dashboards' | transloco }}
        </th>
        <th id="createdDateHeader" pSortableColumn="createdDate" style="width:15rem">
          {{ '@Created date' | transloco }}
          <p-sortIcon field="createdDate"/>
        </th>
        <th id="actionsHeader" style="width:8rem"></th>
      </tr>
    </ng-template>
    <ng-template let-group pTemplate="body">
      <tr>
        <td>
          {{ group.name }}
        </td>
        <td>
          {{ group.entries?.length || 0 }}
        </td>
        <td>
          @if (group.createdDate) {
            <span>{{ group.createdDate | date: 'dd.MM.yyyy HH:mm:ss' }}</span>
          }
        </td>
        <td>
          <p-button (click)="editDashboardGroup(group)" (keydown.enter)="editDashboardGroup(group)"
                    [pTooltip]="'@Edit' | transloco"
                    tooltipPosition="top"
                    severity="success"
                    icon="fas fa-light fa-pen-to-square"
                    [rounded]="true"
                    [text]="true"
                    class="mr-2"/>
          <p-button (click)="showDeletionPopup(group)" (keydown.enter)="showDeletionPopup(group)"
                    [pTooltip]="'@Delete' | transloco"
                    tooltipPosition="top"
                    severity="danger"
                    icon="fas fa-trash"
                    [rounded]="true"
                    [text]="true"/>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
<br/>
<app-delete-dashboard-group-popup [action]="getDeletionAction()"/>
