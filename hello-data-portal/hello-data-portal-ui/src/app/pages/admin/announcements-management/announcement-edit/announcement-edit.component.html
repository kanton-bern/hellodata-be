<div class="card">
  @if ((editedAnnouncement$ | async); as editedAnnouncement) {
    <form [formGroup]="announcementForm">
      <h5>{{ '@Announcement' | transloco }}</h5>
      @if (editedAnnouncement.createdDate) {
        <div class="field grid">
          <label class="col-12 mb-2 md:col-2 md:mb-0" for="createdDate">{{ '@Created date' | transloco }}</label>
          <div class="col-12 md:col-10">
            <input
              class="opacity-40 text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"
              disabled
              id="createdDate"
              type="text"
              value="{{editedAnnouncement.createdDate | date: 'dd.MM.yyyy HH:mm:ss'}}">
          </div>
        </div>
      }
      @if (editedAnnouncement.createdDate) {
        <div class="field grid">
          <label class="col-12 mb-2 md:col-2 md:mb-0" for="createdBy">{{ '@Created by' | transloco }}</label>
          <div class="col-12 md:col-10">
            <input
              class="opacity-40 text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"
              disabled
              id="createdBy"
              type="text"
              value="{{editedAnnouncement.createdBy}}">
          </div>
        </div>
      }
      @if (editedAnnouncement.modifiedDate) {
        <div class="field grid">
          <label class="col-12 mb-2 md:col-2 md:mb-0" for="modifiedDate">{{ '@Modified date' | transloco }}</label>
          <div class="col-12 md:col-10">
            <input
              class="opacity-40 text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full"
              disabled
              id="modifiedDate"
              type="text"
              value="{{editedAnnouncement.modifiedDate | date: 'dd.MM.yyyy HH:mm:ss'}}">
          </div>
        </div>
      }
      @if (editedAnnouncement.modifiedBy) {
        <div class="field grid">
          <label class="col-12 mb-2 md:col-2 md:mb-0" for="createdBy">{{ '@Modified by' | transloco }}</label>
          <div class="col-12 md:col-10">
            <input
              class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full opacity-40"
              disabled
              id="modifiedBy"
              type="text"
              value="{{editedAnnouncement.modifiedBy}}">
          </div>
        </div>
      }
      <div class="field grid">
        <label class="col-12 mb-2 md:col-2 md:mb-0" for="published">{{ '@Published' | transloco }}</label>
        <div class="col-12 md:col-10">
          <p-checkbox [binary]="true" formControlName="published" id="published" inputId="published"></p-checkbox>
        </div>
      </div>
      @if (editedAnnouncement.publishedDate) {
        <div class="field grid">
          <label class="col-12 mb-2 md:col-2 md:mb-0" for="publishedDate">{{ '@Published date' | transloco }}</label>
          <div class="col-12 md:col-10">
            <input
              class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full opacity-40"
              disabled
              id="publishedDate"
              type="text"
              value="{{editedAnnouncement.publishedDate | date: 'dd.MM.yyyy HH:mm:ss'}}">
          </div>
        </div>
      }
      @if ((supportedLanguages$ | async); as supportedLanguages) {
        <p-tabs>
          <p-tablist>
            @for (language of supportedLanguages; track language) {
              <p-tab>
                <div class="flex align-items-center gap-2">
                  <span class="font-bold white-space-nowrap m-0 {{notFilled(language) ? 'not-filled' : ''}}">
                    {{ language.slice(0, 2).toUpperCase() }}
                  </span>
                </div>
              </p-tab>
            }
          </p-tablist>
          <p-tabpanels>
            @for (language of supportedLanguages; track language) {
              <p-tabpanel [value]="language">
                <div class="field grid">
                  <div class="col-12 md:col-12">
                    <p-editor [formControl]="getMessage(language)" [style]="{ width: '100%' }">
                      <ng-template pTemplate="header">
                        <span class="ql-formats">
                          <select class="ql-header">
                            <option value="1">Heading</option>
                            <option value="2">Subheading</option>
                            <option selected>Normal</option>
                          </select>
                          <select class="ql-font">
                            <option selected>Sans Serif</option>
                            <option value="serif">Serif</option>
                            <option value="monospace">Monospace</option>
                          </select>
                        </span>
                        <span class="ql-formats">
                          <p-button aria-label="Bold" class="ql-bold" type="button"></p-button>
                          <p-button aria-label="Italic" class="ql-italic" type="button"></p-button>
                          <p-button aria-label="Underline" class="ql-underline" type="button"></p-button>
                        </span>
                        <span class="ql-formats">
                          <select class="ql-color"></select>
                          <select class="ql-background"></select>
                        </span>
                        <span class="ql-formats">
                          <p-button aria-label="Ordered List" class="ql-list" type="button" value="ordered"></p-button>
                          <p-button aria-label="Unordered List" class="ql-list" type="button" value="bullet"></p-button>
                          <select class="ql-align">
                            <option selected></option>
                            <option value="center">center</option>
                            <option value="right">right</option>
                            <option value="justify">justify</option>
                          </select>
                        </span>
                        <span class="ql-formats">
                          <p-button aria-label="Insert Link" class="ql-link" type="button"></p-button>
                          <p-button aria-label="Insert Code Block" class="ql-code-block" type="button"></p-button>
                        </span>
                        <span class="ql-formats">
                          <p-button aria-label="Remove Styles" class="ql-clean" type="button"></p-button>
                        </span>
                      </ng-template>
                    </p-editor>
                  </div>
                </div>
              </p-tabpanel>
            }
          </p-tabpanels>
        </p-tabs>
      }
      <p-toolbar>
        <div class="p-toolbar-group-start">
          <p-button (click)="navigateToAnnouncementList()" [pTooltip]="'@Cancel' | transloco" class="mr-2"
          icon="fas fa-arrow-left" severity="secondary"></p-button>
        </div>
        @if ((defaultLanguage$ | async); as defaultLanguage) {
          <div class="p-toolbar-group-end">
            <p-button (click)="saveAnnouncement(editedAnnouncement)"
              [disabled]="!isAtLeastDefaultLanguageFilled(defaultLanguage)"
              icon="fas fa-floppy-disk" class="mr-2"
              label="{{'@Save' | transloco}}"
            severity="success"></p-button>
            @if (editedAnnouncement.id) {
              <p-button (click)="openDeletePopup(editedAnnouncement)"
                icon="fas fa-trash" class="mr-2"
                label="{{'@Delete' | transloco}}"
              severity="danger"></p-button>
            }
          </div>
        }
      </p-toolbar>
    </form>
  }
</div>

<app-delete-announcement-popup [action]="getDeletionAction()"></app-delete-announcement-popup>
