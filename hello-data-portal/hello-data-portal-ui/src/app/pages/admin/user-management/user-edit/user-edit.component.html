@if (userForm) {
  <div class="card">
    @if ((editedUser$ | async); as editedUser) {
      <form [formGroup]="userForm" class="form">
        <h4>{{ '@User data' | transloco }}</h4>
        <p-toolbar>
          <div class="p-toolbar-group-start">
            <p-button (click)="cancel()" [pTooltip]="'@Cancel' | transloco" class="mr-2"
                      icon="fas fa-arrow-left" severity="secondary" pRipple/>
          </div>
          <div class="p-toolbar-group-end">
            @if (!editedUser.superuser && editedUser.enabled) {
              <p-button (click)="showUserDisablePopup(editedUser)"
                        icon="fas fa-circle-xmark" pRipple
                        [label]="'@Disable' | transloco"
                        class="mr-2 p-button-warning"/>
            }
            @if (!editedUser.superuser && !editedUser.enabled) {
              <p-button (click)="showUserEnablePopup(editedUser)"
                        icon="fas fa-circle-plus" pRipple
                        [label]="'@Enable' | transloco"
                        severity="success"/>
            }
          </div>
        </p-toolbar>
        <p-divider/>
        <div class="field grid grid-cols-12 gap-4">
          <label class="col-span-12 mb-2 md:col-span-2 md:mb-0" for="email">{{ '@E-mail' | transloco }}</label>
          <div class="col-span-12 md:col-span-10">
            <input
              class="opacity-80 text-base text-color bg-surface-0 mb-1 p-2 border border-solid border-surface rounded-border appearance-none outline-0 focus:border-primary w-full"
              disabled id="email" type="text"
              value="{{editedUser.email}}">
          </div>
        </div>
        <div class="field grid grid-cols-12 gap-4">
          <label class="col-span-12 mb-2 md:col-span-2 md:mb-0" for="firstName">{{ '@First name' | transloco }}</label>
          <div class="col-span-12 md:col-span-10">
            <input
              class="opacity-80 text-base text-color bg-surface-0 mb-1 p-2 border border-solid border-surface rounded-border appearance-none outline-0 focus:border-primary w-full"
              disabled id="firstName" type="text"
              value="{{editedUser.firstName}}">
          </div>
        </div>
        <div class="field grid grid-cols-12 gap-4">
          <label class="col-span-12 mb-2 md:col-span-2 md:mb-0" for="lastName">{{ '@Last name' | transloco }}</label>
          <div class="col-span-12 md:col-span-10">
            <input
              class="opacity-80 text-base text-color bg-surface-0  p-2 border border-solid border-surface rounded-border appearance-none outline-0 focus:border-primary w-full"
              disabled id="lastName" type="text"
              value="{{editedUser.lastName}}">
          </div>
        </div>
        <br>
        <div class="field grid grid-cols-12 gap-4">
          <label class="col-span-12 mb-2 md:col-span-2 md:mb-0">{{ '@Enabled' | transloco }}</label>
          <div class="col-span-12 md:col-span-10">
            @if (editedUser.enabled) {
              <div>
                <i class="fas fa-check"></i>
              </div>
            }
            @if (!editedUser.enabled) {
              <div>
                <i class="fas fa-circle-xmark"></i>
              </div>
            }
          </div>
        </div>
        <p-divider/>
        @if (userForm) {
          <div>
            @if ((dataDomains$ | async); as dataDomains) {
              <div>
                @if ((availableDataDomainRoles$ | async); as availableDataDomainRoles) {
                  <div>
                    <div class="field grid grid-cols-12 gap-4">
                      <h4 class="col-span-12 mb-2 md:col-span-2 md:mb-0">{{ '@Permissions' | transloco }}</h4>
                      <div class="col-span-12 md:col-span-10">
                        &nbsp;
                      </div>
                    </div>
                    <br>
                    @if ((businessDomains$ | async); as businessDomains) {
                      <div class="field grid grid-cols-12 gap-4">
                        <div
                          class="col-span-12 mb-2 md:col-span-2 md:mb-0 font-medium text-lg">{{ '@Business domain' | transloco }}
                        </div>
                        <div
                          class="col-span-12 mb-2 md:col-span-2 md:mb-0 font-medium text-lg">{{ '@User role' | transloco }}
                        </div>
                        <br>
                        <div class="col-span-12 md:col-span-12">
                          @for (businessDomain of businessDomains; track businessDomain) {
                            <div>
                              <br>
                              <div class="field grid grid-cols-12 gap-4">
                                <label class="col-span-12 mb-2 md:col-span-2 md:mb-0">{{ businessDomain.name }}</label>
                                <div class="col-span-12 md:col-span-10">
                                  <p-select
                                    (onChange)="onBusinessDomainRoleSelected($event, dataDomains, availableDataDomainRoles)"
                                    [options]="availableBusinessDomainRoles$ | async"
                                    formControlName="{{businessDomain.contextKey}}"
                                    id="businessDomain"
                                    optionLabel="name"/>
                                </div>
                              </div>
                            </div>
                          }
                        </div>
                      </div>
                    }
                    <br>
                    <div class="field grid grid-cols-12 gap-4">
                      <div
                        class="col-span-12 mb-2 md:col-span-2 md:mb-0 font-medium text-lg">{{ '@Data domain' | transloco }}
                      </div>
                      <div
                        class="col-span-12 mb-2 md:col-span-2 md:mb-0 font-medium text-lg">{{ '@Domain type' | transloco }}
                      </div>
                      <div
                        class="col-span-12 mb-2 md:col-span-2 md:mb-0 font-medium text-lg">{{ '@User role' | transloco }}
                      </div>
                      <br>
                      <div class="col-span-12 md:col-span-12">
                        @for (dataDomain of dataDomains; track dataDomain) {
                          <div>
                            <div class="field grid grid-cols-12 gap-4">
                              <label class="col-span-12 mb-2 md:col-span-2 md:mb-0">{{ dataDomain.name }}</label>
                              <label
                                class="col-span-12 mb-2 md:col-span-2 md:mb-0">{{ dataDomain.extra ? 'Extra' : 'Standard' }}</label>
                              <div class="col-span-12 md:col-span-2">
                                <p-select (onChange)="onDataDomainRoleSelected($event, dataDomain)"
                                          [options]="availableDataDomainRoles"
                                          formControlName="{{dataDomain.contextKey}}"
                                          id="dataDomain"
                                          optionLabel="name"
                                          [style]="{'width': '100%'}"/>
                              </div>
                              @if (dashboardTableVisibility.get(dataDomain.contextKey)) {
                                <div class="col-span-12 md:col-span-6">
                                  <app-dashboard-viewer-permissions
                                    (selectedDashboardsEvent)="selectedDashboardsEvent($event, dataDomain)"
                                    [context]="dataDomain"/>
                                </div>
                              }
                            </div>
                            <p-divider/>
                          </div>
                        }
                      </div>
                    </div>
                  </div>
                }
              </div>
            }
          </div>
        }
        <p-toolbar>
          <div class="p-toolbar-group-start">
            <p-button (click)="cancel()" [pTooltip]="'@Cancel' | transloco" class="mr-2"
                      icon="fas fa-arrow-left" severity="secondary" pRipple/>
            <p-button (click)="updateUser()"
                      [pTooltip]="'@Save' | transloco" [disabled]="saveDisabled"
                      severity="success" [loading]="userSaveButtonDisabled$ | async"
                      [label]="'@Save' | transloco"
                      pRipple/>
          </div>
        </p-toolbar>
      </form>
    }
  </div>
}
<app-actions-user-popup/>
