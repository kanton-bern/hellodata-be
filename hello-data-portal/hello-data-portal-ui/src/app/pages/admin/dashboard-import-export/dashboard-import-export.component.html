<h2 class="content-block">{{ '@Dashboard import-export' | transloco }}</h2>
<div class="card">
  @if ((availableDataDomains$ | async); as dataDomains) {
    <div>
      @for (dataDomain of dataDomains | orderBy: 'data.name' ; track dataDomain) {
        <div>
          @if ((dashboards$ | async); as dashboards) {
            <div>
              @if (dataDomain.data) {
                <div>
                  <h3>{{ dataDomain.data.name }}</h3>
                  <p-table (selectionChange)="onSelectionChange($event, dataDomain.data.key)"
                    [globalFilterFields]="['dashboardTitle', 'instanceName', 'businessProcess', 'department', 'responsibility', 'dataAnalyst', 'status']"
                    [paginator]="true"
                    [rowHover]="true"
                    [rows]="50"
                    [selectionPageOnly]="true"
                    [showCurrentPageReport]="true"
                    [tableStyle]="{ 'min-width': '50rem' }"
                    [value]="filterDashboardsByContext(dashboards, dataDomain.data.key)"
                    dataKey="id"
                    selectionMode="single">
                    <ng-template pTemplate="caption">
                      <div class="flex ">
                        <p-button (click)="exportDashboards(dataDomain.data.key)"
                          [disabled]="getSelectedDashboards(dataDomain.data.key).length === 0"
                          [pTooltip]="'@Export dashboard' | transloco"
                          class="p-button-rounded mr-2"
                          severity="success"
                          icon="fas fa-light fa-download"
                          pButton
                        pRipple />
                        <p-button (click)="toggleImportVisible(dataDomain.data.key)"
                          [pTooltip]="'@Import dashboard' | transloco"
                          class="p-button-rounded mr-2" severity="primary"
                          icon="fas fa-light fa-upload"
                          pButton
                        pRipple />
                      </div>
                      @if (uploadVisible(dataDomain.data.key)) {
                        <p-fileUpload name="file"
                          url="{{uploadDashboardsUrl}}{{dataDomain.data.key}}"
                          (onUpload)="onUploadCompleted($event)"
                          (onError)="onError($event)"
                          (onSelect)="onSelect($event)"
                          [class]="'mt-2'"
                          accept=".zip"
                          [maxFileSize]="5000000000" />
                      }
                    </ng-template>
                    <ng-template pTemplate="header">
                      <tr>
                        <th style="width: 4rem" id="tableHeaderCheckbox">
                          <p-tableHeaderCheckbox />
                        </th>
                        <th id="dashboardTitle" pSortableColumn="dashboardTitle">{{ '@Dashboard' | transloco }}
                          <p-sortIcon field="dashboardTitle" />
                        </th>
                        <th id="contextName" pSortableColumn="contextName">{{ '@Data domain' | transloco }}
                          <p-sortIcon field="contextName" />
                        </th>
                        <th id="businessProcessHeader" pSortableColumn="businessProcess">{{ '@Business process' | transloco }}
                          <p-sortIcon field="businessProcess" />
                        </th>
                        <th id="departmentHeader" pSortableColumn="department">{{ '@Department' | transloco }}
                          <p-sortIcon field="department" />
                        </th>
                        <th id="responsibilityHeader"
                          pSortableColumn="responsibility">{{ '@Professional responsibility' | transloco }}
                          <p-sortIcon field="responsibility" />
                        </th>
                        <th id="dataAnalystHeader" pSortableColumn="dataAnalyst">{{ '@Data analyst' | transloco }}
                          <p-sortIcon field="dataAnalyst" />
                        </th>
                      </tr>
                    </ng-template>
                    <ng-template let-dashboard pTemplate="body">
                      <tr>
                        <td>
                          <p-tableCheckbox [value]="dashboard" />
                        </td>
                        <td>
                          {{ dashboard.dashboardTitle }}
                        </td>
                        <td>
                          {{ dashboard.contextName }}
                        </td>
                        <td>
                          {{ dashboard.businessProcess }}
                        </td>
                        <td>
                          {{ dashboard.department }}
                        </td>
                        <td>
                          {{ dashboard.responsibility }}
                        </td>
                        <td>
                          {{ dashboard.dataAnalyst }}
                        </td>
                      </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                      <tr>
                        <td colspan="9">{{ '@No dashboards found' | transloco }}</td>
                      </tr>
                    </ng-template>
                  </p-table>
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
<div style="display: none">
  <app-silent-login />
</div>
