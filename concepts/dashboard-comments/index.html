
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../data-publisher/">
      
      
        <link rel="next" href="../dashboard-groups/">
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Dashboard Comments - HelloDATA BE Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dashboard-comments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="HelloDATA BE Docs" class="md-header__button md-logo" aria-label="HelloDATA BE Docs" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HelloDATA BE Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dashboard Comments
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../vision/vision-and-goal/" class="md-tabs__link">
          
  
  Vision

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/data-stack/" class="md-tabs__link">
          
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../showcase/" class="md-tabs__link">
          
  
  Concepts

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../manuals/user-manual/" class="md-tabs__link">
          
  
  Manuals

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../more/changelog/" class="md-tabs__link">
          
  
  More

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HelloDATA BE Docs" class="md-nav__button md-logo" aria-label="HelloDATA BE Docs" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    HelloDATA BE Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vision
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Vision
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vision/vision-and-goal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../vision/roadmap/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roadmap
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/data-stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Components & Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/infrastructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infrastructure
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../showcase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Showcase
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workspaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-publisher/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Publisher
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Dashboard Comments
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Dashboard Comments
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    <span class="md-ellipsis">
      Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend-spring-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Backend (Spring Boot)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frontend-angular" class="md-nav__link">
    <span class="md-ellipsis">
      Frontend (Angular)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-model" class="md-nav__link">
    <span class="md-ellipsis">
      Data Model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user-roles-and-permissions" class="md-nav__link">
    <span class="md-ellipsis">
      User Roles and Permissions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User Roles and Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#permission-system" class="md-nav__link">
    <span class="md-ellipsis">
      Permission System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-permission-assignment" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Permission Assignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Validation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Permission Validation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend-dashboardcommentservice" class="md-nav__link">
    <span class="md-ellipsis">
      Backend (DashboardCommentService)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frontend-ngrx-selectors" class="md-nav__link">
    <span class="md-ellipsis">
      Frontend (NgRx Selectors)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comment-lifecycle" class="md-nav__link">
    <span class="md-ellipsis">
      Comment Lifecycle
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Comment Lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#states" class="md-nav__link">
    <span class="md-ellipsis">
      States
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#versioning" class="md-nav__link">
    <span class="md-ellipsis">
      Versioning
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      API Endpoints
    </span>
  </a>
  
    <nav class="md-nav" aria-label="API Endpoints">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requestresponse-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Request/Response Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Request/Response Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-comment" class="md-nav__link">
    <span class="md-ellipsis">
      Create Comment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-comment" class="md-nav__link">
    <span class="md-ellipsis">
      Update Comment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimistic-locking" class="md-nav__link">
    <span class="md-ellipsis">
      Optimistic Locking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visibility-rules" class="md-nav__link">
    <span class="md-ellipsis">
      Visibility Rules
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Visibility Rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-regular-users-read" class="md-nav__link">
    <span class="md-ellipsis">
      For Regular Users (READ)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-authors-write" class="md-nav__link">
    <span class="md-ellipsis">
      For Authors (WRITE)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-reviewers-review" class="md-nav__link">
    <span class="md-ellipsis">
      For Reviewers (REVIEW)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dashboard-access-restriction" class="md-nav__link">
    <span class="md-ellipsis">
      Dashboard Access Restriction
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consolidated-deletion-logic" class="md-nav__link">
    <span class="md-ellipsis">
      Consolidated Deletion Logic
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#features" class="md-nav__link">
    <span class="md-ellipsis">
      Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pointer-url" class="md-nav__link">
    <span class="md-ellipsis">
      Pointer URL
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tags" class="md-nav__link">
    <span class="md-ellipsis">
      Tags
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tags">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tag-display" class="md-nav__link">
    <span class="md-ellipsis">
      Tag Display
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-api" class="md-nav__link">
    <span class="md-ellipsis">
      Tag API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auto-refresh" class="md-nav__link">
    <span class="md-ellipsis">
      Auto-refresh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Database Schema
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Database Schema">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-tables" class="md-nav__link">
    <span class="md-ellipsis">
      Main Tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#table-descriptions" class="md-nav__link">
    <span class="md-ellipsis">
      Table Descriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Table Descriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dashboard_comment" class="md-nav__link">
    <span class="md-ellipsis">
      dashboard_comment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dashboard_comment_version" class="md-nav__link">
    <span class="md-ellipsis">
      dashboard_comment_version
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dashboard_comment_permission" class="md-nav__link">
    <span class="md-ellipsis">
      dashboard_comment_permission
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#permission-table-details" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Table Details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#permission-management-and-synchronization" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Management and Synchronization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Permission Management and Synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-permission-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Permission Initialization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Automatic Permission Initialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initial-setup-via-liquibase-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Setup via Liquibase Migration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user-synchronization-syncallusers" class="md-nav__link">
    <span class="md-ellipsis">
      User Synchronization (syncAllUsers)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-for-automatic-synchronization" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases for Automatic Synchronization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use Cases for Automatic Synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-new-data-domain-added" class="md-nav__link">
    <span class="md-ellipsis">
      1. New Data Domain Added
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-new-user-created" class="md-nav__link">
    <span class="md-ellipsis">
      2. New User Created
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-user-promoted-to-admin" class="md-nav__link">
    <span class="md-ellipsis">
      3. User Promoted to Admin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#importexport" class="md-nav__link">
    <span class="md-ellipsis">
      Import/Export
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Import/Export">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#export" class="md-nav__link">
    <span class="md-ellipsis">
      Export
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Export">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#export-format" class="md-nav__link">
    <span class="md-ellipsis">
      Export Format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import" class="md-nav__link">
    <span class="md-ellipsis">
      Import
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Import">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-scenarios" class="md-nav__link">
    <span class="md-ellipsis">
      Import Scenarios
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Import Scenarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-first-import-same-dashboard-re-import" class="md-nav__link">
    <span class="md-ellipsis">
      1. First Import (Same Dashboard - Re-import)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-import-from-different-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      2. Import from Different Dashboard
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-cross-environment-import" class="md-nav__link">
    <span class="md-ellipsis">
      3. Cross-Environment Import
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-result" class="md-nav__link">
    <span class="md-ellipsis">
      Import Result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Import Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importexport-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Import/Export Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-tracking-importedfromid" class="md-nav__link">
    <span class="md-ellipsis">
      Import Tracking (importedFromId)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mobile-support" class="md-nav__link">
    <span class="md-ellipsis">
      Mobile Support
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dashboard-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dashboard Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workspaces-troubleshoot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Workspace Troubleshoot
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Manuals
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Manuals
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manuals/user-manual/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Manual
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../manuals/role-authorization-concept/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roles & Authorization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    More
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            More
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../more/changelog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../more/glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Glossary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../more/faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="dashboard-comments">Dashboard Comments</h1>
<h2 id="overview">Overview</h2>
<p>The Dashboard Comments feature allows users to create and manage comments directly within dashboards in the HelloDATA
Portal. Comments support a full publishing workflow with draft and published states, versioning, and role-based access
control.</p>
<h2 id="architecture">Architecture</h2>
<h3 id="components">Components</h3>
<h4 id="backend-spring-boot">Backend (Spring Boot)</h4>
<ul>
<li><strong>DashboardCommentController</strong> - REST API controller (<code>/dashboards/{contextKey}/{dashboardId}/comments</code>)</li>
<li><strong>DashboardCommentService</strong> - Business logic and permission validation</li>
<li><strong>DashboardCommentPermissionService</strong> - Permission management and synchronization</li>
<li><strong>DashboardCommentRepository</strong> - JPA repository for comment database operations</li>
<li><strong>DashboardCommentPermissionRepository</strong> - JPA repository for permission database operations</li>
<li><strong>DashboardCommentEntity</strong> - JPA entity for comment metadata</li>
<li><strong>DashboardCommentVersionEntity</strong> - JPA entity for versioned content</li>
<li><strong>DashboardCommentPermissionEntity</strong> - JPA entity for user permissions per data domain</li>
</ul>
<h4 id="frontend-angular">Frontend (Angular)</h4>
<ul>
<li><strong>CommentsFeed</strong> - Main comments panel component</li>
<li><strong>CommentEntryComponent</strong> - Individual comment display with actions</li>
<li><strong>DomainDashboardCommentsComponent</strong> - Aggregated view of all comments for a domain</li>
<li><strong>DashboardCommentUtilsService</strong> - Shared utilities for comment operations</li>
<li><strong>NgRx Store</strong> - State management for comments</li>
</ul>
<h3 id="data-model">Data Model</h3>
<p>The data model consists of three main entities:</p>
<ol>
<li><strong>DashboardCommentEntry</strong> - Immutable comment metadata</li>
<li><strong>DashboardCommentVersion</strong> - Versioned content with history</li>
<li><strong>DashboardCommentPermission</strong> - User permissions per data domain</li>
</ol>
<p><strong>Key Design Points:</strong></p>
<ul>
<li><strong><code>pointerUrl</code> and <code>tags</code></strong> are stored per-version and derived from the active version when displaying</li>
<li><strong>Permissions are independent</strong> of comment data and stored in a separate table</li>
<li><strong>Hierarchical permission model</strong> (REVIEW ⊃ WRITE ⊃ READ) is enforced at application layer</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>┌─────────────────────────────────────────────────────────────┐
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>│                    DashboardCommentEntry                    │
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>├─────────────────────────────────────────────────────────────┤
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>│ id: string (UUID)                                           │
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>│ dashboardId: number                                         │
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>│ dashboardUrl: string                                        │
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>│ contextKey: string                                          │
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>│ author: string                                              │
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>│ authorEmail: string                                         │
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>│ createdDate: number (timestamp)                             │
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>│ deleted: boolean                                            │
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>│ deletedDate?: number                                        │
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>│ deletedBy?: string                                          │
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>│ activeVersion: number                                       │
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>│ hasActiveDraft?: boolean                                    │
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>│ entityVersion: number (for optimistic locking)              │
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>│ importedFromId?: string (original ID when imported)         │
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>│ history: DashboardCommentVersion[]                          │
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>│ pointerUrl?: string (derived from active version)           │
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>│ tags?: string[] (derived from active version)               │
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>└─────────────────────────────────────────────────────────────┘
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>┌─────────────────────────────────────────────────────────────┐
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>│                  DashboardCommentVersion                    │
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>├─────────────────────────────────────────────────────────────┤
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>│ version: number                                             │
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>│ text: string                                                │
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>│ status: DashboardCommentStatus                              │
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>│         (DRAFT | READY_FOR_REVIEW | PUBLISHED | DECLINED    │
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>│          | DELETED)                                         │
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>│ editedDate: number                                          │
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>│ editedBy: string                                            │
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>│ publishedDate?: number                                      │
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>│ publishedBy?: string                                        │
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>│ declineReason?: string                                      │
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>│ deleted: boolean                                            │
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>│ pointerUrl?: string (specific page/chart link for version)  │
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>│ tags?: string[] (tags snapshot for this version)            │
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>└─────────────────────────────────────────────────────────────┘
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>┌─────────────────────────────────────────────────────────────┐
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>│               DashboardCommentPermission                    │
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>├─────────────────────────────────────────────────────────────┤
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>│ id: string (UUID)                                           │
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>│ userId: string (UUID)                                       │
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>│ contextKey: string                                          │
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>│ readComments: boolean                                       │
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>│ writeComments: boolean                                      │
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>│ reviewComments: boolean                                     │
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>│ createdDate?: number (timestamp)                            │
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>│ createdBy?: string                                          │
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>│ modifiedDate?: number (timestamp)                           │
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>│ modifiedBy?: string                                         │
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>└─────────────────────────────────────────────────────────────┘
</code></pre></div>
<p><strong>Relationships:</strong></p>
<ul>
<li><code>DashboardCommentEntry</code> → <code>DashboardCommentVersion</code>: One-to-Many (via <code>history</code> array)</li>
<li><code>DashboardCommentPermission</code> → <code>User</code>: Many-to-One (via <code>userId</code>)</li>
<li><code>DashboardCommentPermission</code> → <code>Context</code>: Many-to-One (via <code>contextKey</code>)</li>
<li><strong>Unique constraint</strong>: One permission record per <code>(userId, contextKey)</code> pair</li>
</ul>
<blockquote>
<p><strong>Note:</strong> The top-level <code>pointerUrl</code> and <code>tags</code> fields on <code>DashboardCommentEntry</code> are <strong>derived</strong> from the active
version in history. They are not stored separately on the comment entity. This ensures that when admins switch
versions (e.g., <code>restoreVersion</code>), the displayed <code>pointerUrl</code> and <code>tags</code> always match the active version's data.</p>
<p><strong>Permission Independence:</strong> The <code>DashboardCommentPermission</code> entity is completely independent from comment data,
allowing administrators to manage commenting permissions separately from comment content. Permissions are
automatically
created during user synchronization and can be manually adjusted per user per data domain.</p>
</blockquote>
<h2 id="user-roles-and-permissions">User Roles and Permissions</h2>
<h3 id="permission-system">Permission System</h3>
<p>The dashboard commenting system uses a <strong>three-level permission model</strong> that is independent of data domain roles:</p>
<table>
<thead>
<tr>
<th>Permission Level</th>
<th>Description</th>
<th>What it includes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>READ</strong></td>
<td>View published comments only</td>
<td>Basic read-only access</td>
</tr>
<tr>
<td><strong>WRITE</strong></td>
<td>Create and manage own comments</td>
<td>READ + create/edit own comments + view own drafts + delete own comments</td>
</tr>
<tr>
<td><strong>REVIEW</strong></td>
<td>Full comment moderation capabilities</td>
<td>WRITE + view/manage all drafts + publish/decline + delete</td>
</tr>
</tbody>
</table>
<p><strong>Key Points:</strong></p>
<ul>
<li>Permissions are stored per user per data domain in <code>dashboard_comment_permission</code> table</li>
<li><strong>Independent of data domain roles</strong> - a user's commenting permissions can differ from their data access level</li>
<li><strong>Hierarchical</strong> - REVIEW includes WRITE capabilities, WRITE includes READ capabilities</li>
<li><strong>Flexible</strong> - administrators can assign custom permission combinations for fine-grained control</li>
</ul>
<h3 id="permission-matrix">Permission Matrix</h3>
<p>The table below shows what each permission level allows:</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>READ</th>
<th>WRITE</th>
<th>REVIEW</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>View published comments</strong></td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><strong>View own drafts/declined</strong></td>
<td></td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><strong>View all drafts/declined</strong></td>
<td></td>
<td></td>
<td>✔</td>
</tr>
<tr>
<td><strong>Create comment</strong></td>
<td></td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><strong>Edit own comment</strong></td>
<td></td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><strong>Edit any comment</strong></td>
<td></td>
<td></td>
<td>✔</td>
</tr>
<tr>
<td><strong>Delete own version/entire</strong></td>
<td></td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><strong>Delete any version/entire</strong></td>
<td></td>
<td></td>
<td>✔</td>
</tr>
<tr>
<td><strong>Send for review</strong></td>
<td></td>
<td>✔</td>
<td>✔</td>
</tr>
<tr>
<td><strong>Publish comment</strong></td>
<td></td>
<td></td>
<td>✔</td>
</tr>
<tr>
<td><strong>Decline comment</strong></td>
<td></td>
<td></td>
<td>✔</td>
</tr>
<tr>
<td><strong>View metadata &amp; versions</strong></td>
<td></td>
<td></td>
<td>✔</td>
</tr>
<tr>
<td><strong>Restore version</strong>*</td>
<td></td>
<td></td>
<td>✔</td>
</tr>
</tbody>
</table>
<p><strong>Legend:</strong></p>
<ul>
<li>✔ = Action allowed</li>
<li>(empty) = Action not allowed</li>
<li>* = Cannot restore version when comment is in READY_FOR_REVIEW status</li>
</ul>
<blockquote>
<p><strong>Note for Administrators:</strong> HELLODATA_ADMIN, BUSINESS_DOMAIN_ADMIN, and DATA_DOMAIN_ADMIN roles act as templates for
default permissions. Their permissions are synced to the <code>dashboard_comment_permission</code> table, which is the primary
source of truth for all authorization checks.</p>
<p><strong>Note:</strong> Dashboard-level access (Superset RBAC) is also validated for restricted roles like <code>DATA_DOMAIN_VIEWER</code>.
Even if they have READ permission for comments in the domain, they can only see comments for dashboards they
can access in Superset.</p>
</blockquote>
<h3 id="automatic-permission-assignment">Automatic Permission Assignment</h3>
<p>When users are synchronized or new domains are created, default permissions are automatically assigned based on portal
roles:</p>
<table>
<thead>
<tr>
<th>Portal Role</th>
<th>Default Comment Permissions</th>
<th>Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>HELLODATA_ADMIN</strong></td>
<td>READ + WRITE + REVIEW</td>
<td>All data domains</td>
</tr>
<tr>
<td><strong>BUSINESS_DOMAIN_ADMIN</strong></td>
<td>READ + WRITE + REVIEW</td>
<td>All data domains</td>
</tr>
<tr>
<td><strong>DATA_DOMAIN_ADMIN</strong></td>
<td>READ + WRITE + REVIEW</td>
<td>Specific data domain</td>
</tr>
<tr>
<td><strong>Regular Users</strong></td>
<td>READ only</td>
<td>All accessible domains</td>
</tr>
<tr>
<td><strong>NONE role</strong></td>
<td>No access</td>
<td>Specific data domain</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Important:</strong> These are default assignments. Administrators can manually adjust individual user permissions through
the User Management UI or database to grant custom access levels.</p>
</blockquote>
<h3 id="permission-validation">Permission Validation</h3>
<h4 id="backend-dashboardcommentservice">Backend (DashboardCommentService)</h4>
<p>The backend validates permissions solely by checking the <code>dashboard_comment_permission</code> table:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">// Check user&#39;s comment permissions for a context</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkHasAccessToComment</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">contextKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="n">DashboardCommentPermissionEntity</span><span class="w"> </span><span class="n">perm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getCommentPermissionForCurrentUser</span><span class="p">(</span><span class="n">contextKey</span><span class="p">);</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">perm</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">perm</span><span class="p">.</span><span class="na">isWriteComments</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseStatusException</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">FORBIDDEN</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;No write permission for comments&quot;</span><span class="p">);</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="p">}</span>
</code></pre></div>
<h4 id="frontend-ngrx-selectors">Frontend (NgRx Selectors)</h4>
<p>Frontend selectors check permissions from the NgRx store state:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">// Check if user can publish comments (requires REVIEW permission)</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">canPublishComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createSelector</span><span class="p">(</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="nx">selectCurrentDashboardContextKey</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="nx">selectCurrentUserCommentPermissions</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="nx">selectIsSuperuser</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="nx">selectIsBusinessDomainAdmin</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="p">(</span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">AppState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">state</span><span class="p">.</span><span class="nx">auth</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="p">(</span><span class="nx">contextKey</span><span class="p">,</span><span class="w"> </span><span class="nx">permissions</span><span class="p">,</span><span class="w"> </span><span class="nx">isSuperuser</span><span class="p">,</span><span class="w"> </span><span class="nx">isBusinessDomainAdmin</span><span class="p">,</span><span class="w"> </span><span class="nx">authState</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="c1">// Admins always have full access</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isSuperuser</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">isBusinessDomainAdmin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">        </span><span class="c1">// Check if user is data domain admin for this context</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">isDataDomainAdmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">authState</span><span class="p">.</span><span class="nx">contextRoles</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="nx">role</span><span class="w"> </span><span class="p">=&gt;</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">            </span><span class="nx">role</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">contextKey</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">contextKey</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">            </span><span class="nx">role</span><span class="p">.</span><span class="nx">role</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">DATA_DOMAIN_ADMIN_ROLE</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">isDataDomainAdmin</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">        </span><span class="c1">// Check REVIEW permission from permission table</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">permissions</span><span class="o">?</span><span class="p">.</span><span class="nx">reviewComments</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="p">);</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="c1">// Check if user can create/edit comments (requires WRITE permission)</span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">canEditComment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createSelector</span><span class="p">(</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">    </span><span class="nx">selectCurrentDashboardContextKey</span><span class="p">,</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">    </span><span class="nx">selectCurrentUserCommentPermissions</span><span class="p">,</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">    </span><span class="nx">selectCurrentUserEmail</span><span class="p">,</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">    </span><span class="p">(</span><span class="nx">contextKey</span><span class="p">,</span><span class="w"> </span><span class="nx">permissions</span><span class="p">,</span><span class="w"> </span><span class="nx">currentUserEmail</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">comment</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">        </span><span class="c1">// User can edit their own comments with WRITE permission</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">authorEmail</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">currentUserEmail</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">permissions</span><span class="o">?</span><span class="p">.</span><span class="nx">writeComments</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">        </span><span class="c1">// Or edit any comment with REVIEW permission</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">permissions</span><span class="o">?</span><span class="p">.</span><span class="nx">reviewComments</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="p">);</span>
</code></pre></div>
<h2 id="comment-lifecycle">Comment Lifecycle</h2>
<h3 id="states">States</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>  ┌──────────┐   send for review   ┌──────────────────┐    publish     ┌───────────┐
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  │  DRAFT   │ ──────────────────► │ READY_FOR_REVIEW │ ─────────────► │ PUBLISHED │
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  └──────────┘                     └──────────────────┘                └───────────┘
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>       ▲                                   │                                 │
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>       │              decline              │                                 │
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>       └───────────────────────────────────┘                                 │
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>                                                                             │
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>       ▲                                                                     │
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>       │                          edit published                             │
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>       └─────────────────────────────────────────────────────────────────────┘
</code></pre></div>
<h3 id="workflow">Workflow</h3>
<ol>
<li><strong>Create Comment</strong> - User creates a comment (status: DRAFT, version: 1)</li>
<li><strong>Edit Draft</strong> - Author or admin can edit the draft text</li>
<li><strong>Send for Review</strong> - Author sends the draft for moderation (status: READY_FOR_REVIEW)</li>
<li><strong>Decline</strong> - Reviewer declines the draft with a reason (status: DECLINED)</li>
<li><strong>Publish</strong> - Reviewer publishes the comment (status: PUBLISHED)</li>
<li><strong>Edit Published</strong> - Creates a new DRAFT version while keeping the published version active</li>
<li><strong>Delete</strong> - Soft deletes current version; restores last published if available. If <code>deleteEntire</code> is true, soft
   deletes the entire comment entity.</li>
</ol>
<h3 id="versioning">Versioning</h3>
<p>Each edit to a published comment creates a new version:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>Version 1 (PUBLISHED) ─► Version 2 (DRAFT) ─► Version 2 (PUBLISHED) ─► Version 3 (DRAFT)
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>                                                       │
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>                                               (activeVersion = 3)
</code></pre></div>
<ul>
<li><strong>activeVersion</strong> - Points to the currently active version</li>
<li><strong>hasActiveDraft</strong> - True when a draft version exists</li>
<li>Admins can restore any non-deleted PUBLISHED version</li>
</ul>
<h2 id="api-endpoints">API Endpoints</h2>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GET</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments</code></td>
<td>Get all visible comments</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments</code></td>
<td>Create new comment</td>
</tr>
<tr>
<td><code>PUT</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}</code></td>
<td>Update draft comment</td>
</tr>
<tr>
<td><code>DELETE</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}</code></td>
<td>Delete comment version or entire</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}/send-for-review</code></td>
<td>Send draft for review</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}/decline</code></td>
<td>Decline draft with reason</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}/publish</code></td>
<td>Publish comment</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}/clone</code></td>
<td>Clone for edit (creates new version)</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/{commentId}/restore/{versionNumber}</code></td>
<td>Restore specific version</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/tags</code></td>
<td>Get all tags for dashboard</td>
</tr>
<tr>
<td><code>GET</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/export</code></td>
<td>Export comments to JSON</td>
</tr>
<tr>
<td><code>POST</code></td>
<td><code>/dashboards/{contextKey}/{dashboardId}/comments/import</code></td>
<td>Import comments from JSON</td>
</tr>
</tbody>
</table>
<h3 id="requestresponse-examples">Request/Response Examples</h3>
<h4 id="create-comment">Create Comment</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">// POST /dashboards/demo/5/comments</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1">// Request:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">{</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This dashboard shows sales metrics&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">&quot;dashboardUrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://superset.example.com/superset/dashboard/5/&quot;</span><span class="p">,</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">  </span><span class="nt">&quot;pointerUrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://superset.example.com/superset/dashboard/5/?tab=sales&quot;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="p">}</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="c1">// Response:</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">{</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">  </span><span class="nt">&quot;dashboardId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">  </span><span class="nt">&quot;contextKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo&quot;</span><span class="p">,</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">  </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">  </span><span class="nt">&quot;authorEmail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john.doe@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">  </span><span class="nt">&quot;createdDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705827600000</span><span class="p">,</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">  </span><span class="nt">&quot;activeVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">  </span><span class="nt">&quot;entityVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">  </span><span class="nt">&quot;history&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">      </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;This dashboard shows sales metrics&quot;</span><span class="p">,</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DRAFT&quot;</span><span class="p">,</span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="w">      </span><span class="nt">&quot;editedDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705827600000</span><span class="p">,</span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a><span class="w">      </span><span class="nt">&quot;editedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a><span class="w">      </span><span class="nt">&quot;deleted&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a><span class="p">}</span>
</code></pre></div>
<h4 id="update-comment">Update Comment</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1">// PUT /dashboards/demo/5/comments/550e8400-e29b-41d4-a716-446655440000</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="c1">// Request:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">{</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Updated comment text&quot;</span><span class="p">,</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">  </span><span class="nt">&quot;entityVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">}</span>
</code></pre></div>
<h2 id="optimistic-locking">Optimistic Locking</h2>
<p>To prevent concurrent edit conflicts, the system uses optimistic locking via <code>entityVersion</code>:</p>
<ol>
<li>Client sends <code>entityVersion</code> with update request</li>
<li>Backend verifies <code>entityVersion</code> matches current value</li>
<li>If mismatch, returns <code>409 Conflict</code> error</li>
<li>Client receives notification and refreshes comments</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">checkEntityVersion</span><span class="p">(</span><span class="n">DashboardCommentEntity</span><span class="w"> </span><span class="n">comment</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">providedVersion</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">userEmail</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">providedVersion</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">providedVersion</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">comment</span><span class="p">.</span><span class="na">getEntityVersion</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;Optimistic lock conflict for comment {}, current: {}, provided: {}&quot;</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">                </span><span class="n">comment</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">comment</span><span class="p">.</span><span class="na">getEntityVersion</span><span class="p">(),</span><span class="w"> </span><span class="n">providedVersion</span><span class="p">);</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ResponseStatusException</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">CONFLICT</span><span class="p">,</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">                </span><span class="s">&quot;Comment was modified by another user. Please refresh and try again.&quot;</span><span class="p">);</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="p">}</span>
</code></pre></div>
<h2 id="visibility-rules">Visibility Rules</h2>
<h3 id="for-regular-users-read">For Regular Users (READ)</h3>
<ul>
<li>See all PUBLISHED comments</li>
<li>If current activeVersion is a DRAFT, READY_FOR_REVIEW or DECLINED by someone else → show last PUBLISHED version
  instead</li>
<li>If no PUBLISHED version exists → comment is hidden</li>
</ul>
<h3 id="for-authors-write">For Authors (WRITE)</h3>
<ul>
<li>See all rules for Regular Users</li>
<li>See own DRAFT, READY_FOR_REVIEW, and DECLINED versions</li>
<li>Author can see their own declined version to read the decline reason</li>
</ul>
<h3 id="for-reviewers-review">For Reviewers (REVIEW)</h3>
<ul>
<li>See all comments (DRAFT, READY_FOR_REVIEW, PUBLISHED, DECLINED)</li>
<li>See complete version history</li>
<li>Can switch between versions for any comment</li>
</ul>
<h3 id="dashboard-access-restriction">Dashboard Access Restriction</h3>
<p>Users with certain roles (e.g., <code>DATA_DOMAIN_VIEWER</code>, <code>BUSINESS_SPECIALIST</code>) are restricted to seeing comments only on
dashboards they have explicit access to via Superset RBAC. This is enforced by the backend by matching user roles
against the required roles for each dashboard.</p>
<h2 id="consolidated-deletion-logic">Consolidated Deletion Logic</h2>
<p>The deletion process has been simplified into a single "Delete" action:</p>
<ol>
<li><strong>Delete Version (Default)</strong>: By default, the delete action soft-deletes the current active version (sets status to
   <code>DELETED</code>).<ul>
<li>If a previous <code>PUBLISHED</code> version exists, the comment is restored to that version.</li>
<li>If no published version exists, the entire comment is soft-deleted.</li>
</ul>
</li>
<li><strong>Delete Entire Comment</strong>: If the user explicitly selects "Delete entire comment", the entire comment entity is
   soft-deleted regardless of version history.</li>
</ol>
<p>Authors can delete their own DRAFT or DECLINED versions. Reviewers can delete any version or entire comments.</p>
<h2 id="features">Features</h2>
<h3 id="pointer-url">Pointer URL</h3>
<p>Comments can include an optional <code>pointerUrl</code> that links to a specific dashboard page, tab, or chart:</p>
<ul>
<li>Validated to ensure it points to the same Superset instance</li>
<li>Clicking the link loads that specific view in the iframe</li>
</ul>
<h3 id="tags">Tags</h3>
<p>Comments can be tagged with short labels for better organization and filtering:</p>
<ul>
<li><strong>Scope</strong>: Tags are scoped per dashboard - each dashboard has its own set of tags</li>
<li><strong>Length</strong>: Maximum 10 characters per tag</li>
<li><strong>Normalization</strong>: Tags are automatically trimmed, lowercased, and deduplicated</li>
<li><strong>Multiple tags</strong>: A comment can have multiple tags assigned</li>
<li><strong>Autocomplete</strong>: When adding tags, existing tags from the dashboard are suggested</li>
<li><strong>Filtering</strong>: Comments can be filtered by tag in the comments panel</li>
<li><strong>Permissions</strong>: Adding/editing tags follows the same permission rules as editing comments</li>
<li><strong>History tracking</strong>: Each version stores a snapshot of tags - changes to tags are visible in version history</li>
</ul>
<h4 id="tag-display">Tag Display</h4>
<ul>
<li>Tags are displayed at the bottom of each comment entry</li>
<li>Each tag shows with a tag icon (<code>fa-solid fa-tag</code>) followed by the tag name</li>
<li>Tags have a distinctive blue chip styling for easy identification</li>
<li>In version history, tags for each version are shown, allowing comparison of tag changes</li>
</ul>
<h4 id="tag-api">Tag API</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>GET /dashboards/{contextKey}/{dashboardId}/comments/tags
</code></pre></div>
<p>Returns all unique tags used in comments for a specific dashboard.</p>
<ul>
<li>Useful for referencing specific parts of complex dashboards</li>
</ul>
<h3 id="filtering">Filtering</h3>
<p>Domain comments view supports filtering by:</p>
<ul>
<li>Year</li>
<li>Quarter (based on comment creation date)</li>
<li>Tag (if any comments have tags assigned)</li>
<li>Text search (searches comment text content)</li>
</ul>
<h3 id="auto-refresh">Auto-refresh</h3>
<p>Comments are automatically refreshed every 30 seconds when viewing a dashboard.</p>
<h2 id="database-schema">Database Schema</h2>
<h3 id="main-tables">Main Tables</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dashboard_comment</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">(</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">id</span><span class="w">               </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="n">dashboard_id</span><span class="w">     </span><span class="nb">INTEGER</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="n">dashboard_url</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2048</span><span class="p">),</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="n">context_key</span><span class="w">      </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="n">author</span><span class="w">           </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="n">author_email</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="n">created_date</span><span class="w">     </span><span class="nb">BIGINT</span><span class="p">,</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="n">deleted</span><span class="w">          </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="n">deleted_date</span><span class="w">     </span><span class="nb">BIGINT</span><span class="p">,</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="n">deleted_by</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="n">active_version</span><span class="w">   </span><span class="nb">INTEGER</span><span class="p">,</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="n">has_active_draft</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="n">entity_version</span><span class="w">   </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">    </span><span class="n">imported_from_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Original ID when imported from another dashboard</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="p">);</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dashboard_comment_version</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="p">(</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">    </span><span class="n">id</span><span class="w">             </span><span class="n">BIGSERIAL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="w">    </span><span class="n">comment_id</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">dashboard_comment</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="w">    </span><span class="k">version</span><span class="w">        </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="nb">text</span><span class="w">           </span><span class="nb">TEXT</span><span class="p">,</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">    </span><span class="n">status</span><span class="w">         </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="w">    </span><span class="n">edited_date</span><span class="w">    </span><span class="nb">BIGINT</span><span class="p">,</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">    </span><span class="n">edited_by</span><span class="w">      </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">    </span><span class="n">published_date</span><span class="w"> </span><span class="nb">BIGINT</span><span class="p">,</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">    </span><span class="n">published_by</span><span class="w">   </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">    </span><span class="n">deleted</span><span class="w">        </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">    </span><span class="n">tags</span><span class="w">           </span><span class="nb">TEXT</span><span class="p">,</span><span class="w">         </span><span class="c1">-- Comma-separated tags snapshot for this version</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">    </span><span class="n">pointer_url</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span><span class="w"> </span><span class="c1">-- Optional link to specific page/chart for this version</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="p">);</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">dashboard_comment_permission</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="p">(</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">    </span><span class="n">id</span><span class="w">              </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">    </span><span class="n">user_id</span><span class="w">         </span><span class="n">UUID</span><span class="w">         </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">    </span><span class="n">context_key</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">    </span><span class="n">read_comments</span><span class="w">   </span><span class="nb">BOOLEAN</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">    </span><span class="n">write_comments</span><span class="w">  </span><span class="nb">BOOLEAN</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">    </span><span class="n">review_comments</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w">      </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">    </span><span class="n">created_date</span><span class="w">    </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">    </span><span class="n">created_by</span><span class="w">      </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">    </span><span class="n">modified_date</span><span class="w">   </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">    </span><span class="n">modified_by</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">uq_dashboard_comment_permission_user_context</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">context_key</span><span class="p">),</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_dashboard_comment_permission_user</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="w">        </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">user_</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">fk_dashboard_comment_permission_context</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">context_key</span><span class="p">)</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="w">        </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="p">(</span><span class="n">context_key</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="p">);</span>
<a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>
<a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="c1">-- Indexes for comment lookups</span>
<a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_dashboard_comment_context_dashboard</span>
<a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">dashboard_comment</span><span class="w"> </span><span class="p">(</span><span class="n">context_key</span><span class="p">,</span><span class="w"> </span><span class="n">dashboard_id</span><span class="p">);</span>
<a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>
<a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="c1">-- Index for import duplicate detection</span>
<a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_comment_imported_from</span>
<a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">dashboard_comment</span><span class="w"> </span><span class="p">(</span><span class="n">imported_from_id</span><span class="p">,</span><span class="w"> </span><span class="n">context_key</span><span class="p">,</span><span class="w"> </span><span class="n">dashboard_id</span><span class="p">);</span>
<a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>
<a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a><span class="c1">-- Indexes for permission lookups</span>
<a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_comment_permission_user</span>
<a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">dashboard_comment_permission</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>
<a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_comment_permission_context</span>
<a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a><span class="w">    </span><span class="k">ON</span><span class="w"> </span><span class="n">dashboard_comment_permission</span><span class="w"> </span><span class="p">(</span><span class="n">context_key</span><span class="p">);</span>
</code></pre></div>
<h3 id="table-descriptions">Table Descriptions</h3>
<h4 id="dashboard_comment">dashboard_comment</h4>
<p>Main comment entity storing metadata and reference to active version. Uses optimistic locking via <code>entity_version</code>.</p>
<h4 id="dashboard_comment_version">dashboard_comment_version</h4>
<p>Stores complete version history including text, status, tags, and pointer URLs. Each version is immutable once created.</p>
<h4 id="dashboard_comment_permission">dashboard_comment_permission</h4>
<p>Stores per-user per-data-domain commenting permissions. Independent of comment data, allowing flexible permission
management.</p>
<blockquote>
<p><strong>Note:</strong> <code>pointer_url</code> and <code>tags</code> are stored <strong>per version</strong> in <code>dashboard_comment_version</code>, not on the main
<code>dashboard_comment</code> table. This design ensures each version snapshot captures the complete state (text, tags,
pointerUrl) at that point in time. The application derives the current <code>pointerUrl</code> and <code>tags</code> from the active
version when building DTOs.</p>
</blockquote>
<h3 id="permission-table-details">Permission Table Details</h3>
<p>The <code>dashboard_comment_permission</code> table provides fine-grained control over commenting capabilities:</p>
<ul>
<li><strong>Unique constraint</strong> on <code>(user_id, context_key)</code> ensures one permission record per user per domain</li>
<li><strong>Cascade delete</strong> on user and context ensures automatic cleanup</li>
<li><strong>Boolean flags</strong> represent the three permission levels (read, write, review)</li>
<li><strong>Hierarchical permissions</strong> are enforced by the application layer (review → write → read)</li>
<li><strong>Audit fields</strong> track when and by whom permissions were created/modified</li>
<li><strong>Independent storage</strong> allows permission management without affecting comment data</li>
</ul>
<h2 id="permission-management-and-synchronization">Permission Management and Synchronization</h2>
<h3 id="automatic-permission-initialization">Automatic Permission Initialization</h3>
<h4 id="initial-setup-via-liquibase-migration">Initial Setup via Liquibase Migration</h4>
<p>When the system is first deployed or upgraded, a Liquibase migration (<code>55_initialize_dashboard_comment_permissions.sql</code>)
automatically creates default permissions for all existing users:</p>
<p><strong>Migration Logic:</strong></p>
<ol>
<li><strong>Admins (HELLODATA_ADMIN, BUSINESS_DOMAIN_ADMIN)</strong> → Full access (READ + WRITE + REVIEW) in all domains</li>
<li><strong>Data Domain Admins (DATA_DOMAIN_ADMIN)</strong> → Full access (READ + WRITE + REVIEW) in their specific domain</li>
<li><strong>Regular users</strong> → Read-only access (READ) in all domains</li>
</ol>
<p>The migration uses SQL JOINs with <code>user_portal_role</code> and <code>user_context_role</code> tables to determine user roles and is *
<em>idempotent</em>* - running it multiple times will not create duplicates.</p>
<h4 id="user-synchronization-syncallusers">User Synchronization (syncAllUsers)</h4>
<p>The <code>syncAllUsers()</code> method in <code>UserService</code> automatically maintains comment permissions when users are synchronized:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1">// In UserService.syncAllUsers()</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">dashboardCommentPermissionService</span><span class="p">.</span><span class="na">syncDefaultPermissionsForUser</span><span class="p">(</span><span class="n">userEntity</span><span class="p">);</span>
</code></pre></div>
<p><strong>When it runs:</strong></p>
<ul>
<li>During scheduled user synchronization</li>
<li>When new users are created</li>
<li>When new data domains are added</li>
</ul>
<p><strong>What it does:</strong></p>
<ul>
<li>Checks if user has admin roles (HELLODATA_ADMIN or BUSINESS_DOMAIN_ADMIN)</li>
<li>Creates missing permissions for any data domains where user doesn't have permissions yet</li>
<li><strong>Never modifies existing permissions</strong> - only creates new ones for new domains</li>
<li>Logs the number of permissions created for each user</li>
</ul>
<p><strong>Permission Assignment:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">if</span><span class="p">(</span><span class="n">isAdmin</span><span class="p">){</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">        </span><span class="c1">// Admins get full access</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">        </span><span class="n">permission</span><span class="p">.</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="nf">setReadComments</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="n">permission</span><span class="p">.</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="nf">setWriteComments</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span><span class="n">permission</span><span class="p">.</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="nf">setReviewComments</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">        </span><span class="c1">// Regular users get read-only</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">        </span><span class="n">permission</span><span class="p">.</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="nf">setReadComments</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">    </span><span class="n">permission</span><span class="p">.</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="nf">setWriteComments</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="n">permission</span><span class="p">.</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="nf">setReviewComments</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="p">}</span>
</code></pre></div>
<h3 id="use-cases-for-automatic-synchronization">Use Cases for Automatic Synchronization</h3>
<h4 id="1-new-data-domain-added">1. New Data Domain Added</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>Scenario: Administrator creates a new data domain &quot;finance&quot;
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Result:   syncAllUsers() runs automatically
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>          - All admins receive READ+WRITE+REVIEW for &quot;finance&quot;
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>          - All regular users receive READ for &quot;finance&quot;
</code></pre></div>
<h4 id="2-new-user-created">2. New User Created</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Scenario: New user &quot;john@example.com&quot; is added to the system
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Result:   syncAllUsers() processes the new user
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>          - Permissions created for all existing data domains
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>          - Permission level based on user&#39;s portal role
</code></pre></div>
<h4 id="3-user-promoted-to-admin">3. User Promoted to Admin</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Scenario: Regular user is promoted to BUSINESS_DOMAIN_ADMIN
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>Result:   syncAllUsers() does NOT automatically upgrade existing permissions
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>Action:   Administrator must manually update permissions via database
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>          OR re-run migration to reset all permissions
</code></pre></div>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>New Domains</strong>: Always run user sync after creating new data domains to ensure all users get appropriate permissions</li>
<li><strong>Role Changes</strong>: When promoting users to admin roles, consider manually updating their comment permissions if
   immediate access is needed</li>
<li><strong>Permission Auditing</strong>: Use <code>created_by</code> and <code>modified_by</code> fields to track permission changes</li>
<li><strong>Regular Sync</strong>: Schedule regular <code>syncAllUsers()</code> execution to catch any missing permissions</li>
</ol>
<h3 id="troubleshooting">Troubleshooting</h3>
<p><strong>Problem:</strong> User cannot see comment actions despite having correct domain role</p>
<p><strong>Solution:</strong></p>
<ol>
<li>Check <code>dashboard_comment_permission</code> table for user's permissions</li>
<li>Verify <code>context_key</code> matches the current dashboard's domain</li>
<li>Run <code>syncAllUsers()</code> to create missing permissions</li>
<li>Check application logs for permission validation errors</li>
</ol>
<p><strong>SQL Query to Check Permissions:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w">       </span><span class="n">dcp</span><span class="p">.</span><span class="n">context_key</span><span class="p">,</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="w">       </span><span class="n">dcp</span><span class="p">.</span><span class="n">read_comments</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w">       </span><span class="n">dcp</span><span class="p">.</span><span class="n">write_comments</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w">       </span><span class="n">dcp</span><span class="p">.</span><span class="n">review_comments</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">FROM</span><span class="w"> </span><span class="n">dashboard_comment_permission</span><span class="w"> </span><span class="n">dcp</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">         </span><span class="k">JOIN</span><span class="w"> </span><span class="n">user_</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">dcp</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user@example.com&#39;</span><span class="p">;</span>
</code></pre></div>
<h2 id="error-handling">Error Handling</h2>
<table>
<thead>
<tr>
<th>HTTP Status</th>
<th>Scenario</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>403 Forbidden</code></td>
<td>User lacks permission for the action</td>
</tr>
<tr>
<td><code>404 Not Found</code></td>
<td>Comment not found</td>
</tr>
<tr>
<td><code>409 Conflict</code></td>
<td>Optimistic locking conflict (concurrent edit)</td>
</tr>
</tbody>
</table>
<h2 id="importexport">Import/Export</h2>
<p>Comments can be exported and imported between dashboards for migration, backup, or copying comments across environments.</p>
<h3 id="export">Export</h3>
<ul>
<li><strong>Format</strong>: JSON file</li>
<li><strong>Scope</strong>: Exports all non-deleted comments with complete version history (both DRAFT and PUBLISHED)</li>
<li><strong>Contents</strong>: Comment ID, text, author, creation date, status, tags, activeVersion, and full version history</li>
<li><strong>Permission</strong>: Only admins (superuser, business_domain_admin, data_domain_admin) can export</li>
<li><strong>File naming</strong>: <code>comments_{contextKey}_{dashboardTitle}_{date}.json</code> (title is sanitized for filesystem)</li>
</ul>
<h4 id="export-format">Export Format</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="nt">&quot;exportVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">&quot;contextKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;demo&quot;</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">  </span><span class="nt">&quot;dashboardId&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">  </span><span class="nt">&quot;dashboardTitle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Sales Dashboard&quot;</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">  </span><span class="nt">&quot;exportDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705827600000</span><span class="p">,</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">  </span><span class="nt">&quot;comments&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Current active version text&quot;</span><span class="p">,</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">      </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">      </span><span class="nt">&quot;authorEmail&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;john.doe@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">      </span><span class="nt">&quot;createdDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705827600000</span><span class="p">,</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PUBLISHED&quot;</span><span class="p">,</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">      </span><span class="nt">&quot;activeVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">      </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">        </span><span class="s2">&quot;sales&quot;</span><span class="p">,</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">        </span><span class="s2">&quot;kpi&quot;</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">      </span><span class="p">],</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">      </span><span class="nt">&quot;history&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">          </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">          </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;First version text&quot;</span><span class="p">,</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">          </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PUBLISHED&quot;</span><span class="p">,</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">          </span><span class="nt">&quot;editedDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705827600000</span><span class="p">,</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">          </span><span class="nt">&quot;editedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">          </span><span class="nt">&quot;publishedDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705828000000</span><span class="p">,</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="w">          </span><span class="nt">&quot;publishedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Admin User&quot;</span><span class="p">,</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">          </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">            </span><span class="s2">&quot;sales&quot;</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">          </span><span class="p">]</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">        </span><span class="p">},</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">          </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">          </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Current active version text&quot;</span><span class="p">,</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="w">          </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PUBLISHED&quot;</span><span class="p">,</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="w">          </span><span class="nt">&quot;editedDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705830000000</span><span class="p">,</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">          </span><span class="nt">&quot;editedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Jane Smith&quot;</span><span class="p">,</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">          </span><span class="nt">&quot;publishedDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1705831000000</span><span class="p">,</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">          </span><span class="nt">&quot;publishedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Admin User&quot;</span><span class="p">,</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">          </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">            </span><span class="s2">&quot;sales&quot;</span><span class="p">,</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">            </span><span class="s2">&quot;kpi&quot;</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a><span class="w">          </span><span class="p">]</span>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">      </span><span class="p">]</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a><span class="p">}</span>
</code></pre></div>
<h3 id="import">Import</h3>
<ul>
<li><strong>Permission</strong>: Only admins (superuser, business_domain_admin, data_domain_admin) can import</li>
<li><strong>Status preservation</strong>: Comments are imported with their original status (DRAFT or PUBLISHED) preserved</li>
<li><strong>History preservation</strong>: Full version history is imported, allowing admins to review previous versions</li>
<li><strong>Pointer URL</strong>: Preserved per-version from export file (stored on each version in history)</li>
<li><strong>Dashboard URL</strong>: Automatically set to the target dashboard URL (not copied from source)</li>
<li><strong>Tags</strong>: Preserved per-version from export file</li>
<li><strong>Author</strong>: Preserved from export if available, otherwise uses importing user</li>
</ul>
<h4 id="import-scenarios">Import Scenarios</h4>
<h5 id="1-first-import-same-dashboard-re-import">1. First Import (Same Dashboard - Re-import)</h5>
<p>When importing to the same dashboard where comments were originally exported:</p>
<ul>
<li>Comments with matching IDs are <strong>updated</strong> with imported data</li>
<li>New comments (no matching ID) are created</li>
<li>Prevents duplicate comments on re-import</li>
</ul>
<h5 id="2-import-from-different-dashboard">2. Import from Different Dashboard</h5>
<p>When importing to a different dashboard:</p>
<ul>
<li>New comments are created with new IDs</li>
<li>The <code>importedFromId</code> field tracks the original comment ID</li>
<li>On subsequent imports of the same file, comments are <strong>updated</strong> (not duplicated) based on <code>importedFromId</code></li>
</ul>
<h5 id="3-cross-environment-import">3. Cross-Environment Import</h5>
<p>When importing from another environment (e.g., DEV → PROD):</p>
<ul>
<li>Comments are created with new IDs</li>
<li>Original author information is preserved</li>
<li><code>importedFromId</code> enables re-import without duplicates</li>
</ul>
<h4 id="import-result">Import Result</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w">  </span><span class="nt">&quot;imported&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="nt">&quot;updated&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="nt">&quot;skipped&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Imported 5 new, updated 2 existing, skipped 1&quot;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>imported</strong>: Number of new comments created</li>
<li><strong>updated</strong>: Number of existing comments updated</li>
<li><strong>skipped</strong>: Number of invalid items (e.g., empty text)</li>
</ul>
<h4 id="import-validation">Import Validation</h4>
<ul>
<li>File must be valid JSON</li>
<li>Comments without text are skipped</li>
<li>Invalid tags are normalized or skipped</li>
<li>Dashboard URL is replaced with target dashboard URL</li>
</ul>
<h3 id="importexport-use-cases">Import/Export Use Cases</h3>
<ol>
<li><strong>Backup</strong>: Export comments before major changes</li>
<li><strong>Migration</strong>: Move comments when restructuring dashboards</li>
<li><strong>Template</strong>: Create standard comments that can be imported to multiple dashboards</li>
<li><strong>Cross-environment</strong>: Copy comments from development to production environment</li>
<li><strong>Disaster recovery</strong>: Restore comments from backup after data loss</li>
</ol>
<h3 id="import-tracking-importedfromid">Import Tracking (importedFromId)</h3>
<p>The <code>importedFromId</code> field in the database tracks the original comment ID from import. This enables:</p>
<ul>
<li>Detection of previously imported comments to prevent duplicates</li>
<li>Traceability of comment origins</li>
<li>Safe re-imports that update existing comments instead of creating duplicates</li>
</ul>
<h2 id="mobile-support">Mobile Support</h2>
<p>The comments panel adapts to mobile view:</p>
<ul>
<li>Comments panel opens as a drawer from the top</li>
<li>Simplified UI for touch interaction</li>
<li>Full functionality preserved</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 Designed and Developed by <a href="https://www.bedag.ch/" target="blank" rel="noopener">Bedag Solutions AG</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/kanton-bern/hellodata-be/" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/kanton_bern" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/kaio/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>